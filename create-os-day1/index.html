<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>macでOSを自作（1日目） | Haystacker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="description" content="バイナリによる OS イメージの作成0xED ファイルを開き、以下のように入力後、helloos.img として保存する。（”55 AA F0 FF FF” 以降は 167FF2 までひたすら 0）1234567891011121314151617181920EB 4E 90 48 45 4C 4C 4F 49 50 4C 00 02 01 01 00 02 E0 00 40 0B F0 09 0">
<meta name="keywords" content="OS">
<meta property="og:type" content="article">
<meta property="og:title" content="macでOSを自作（1日目）">
<meta property="og:url" content="http://haystacker.net/create-os-day1/index.html">
<meta property="og:site_name" content="Haystacker">
<meta property="og:description" content="バイナリによる OS イメージの作成0xED ファイルを開き、以下のように入力後、helloos.img として保存する。（”55 AA F0 FF FF” 以降は 167FF2 までひたすら 0）1234567891011121314151617181920EB 4E 90 48 45 4C 4C 4F 49 50 4C 00 02 01 01 00 02 E0 00 40 0B F0 09 0">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://haystacker.net/create-os-day1//0xed.png">
<meta property="og:updated_time" content="2018-09-22T05:57:47.919Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="macでOSを自作（1日目）">
<meta name="twitter:description" content="バイナリによる OS イメージの作成0xED ファイルを開き、以下のように入力後、helloos.img として保存する。（”55 AA F0 FF FF” 以降は 167FF2 までひたすら 0）1234567891011121314151617181920EB 4E 90 48 45 4C 4C 4F 49 50 4C 00 02 01 01 00 02 E0 00 40 0B F0 09 0">
<meta name="twitter:image" content="http://haystacker.net/create-os-day1//0xed.png">
<meta name="twitter:creator" content="@jundo414">
  
    <link rel="alternative" href="/atom.xml" title="Haystacker" type="application/atom+xml">
  
  
    <link rel="icon" href="favicon.ico">
  
  <link href='//fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/css/style.css">
  

  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Haystacker</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        
          <a id="nav-search-btn" class="nav-icon" title="Search"></a>
        
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://haystacker.net"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-create-os-day1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/create-os-day1/" class="article-date">
  <time datetime="2018-09-09T00:50:37.000Z" itemprop="datePublished">2018-09-09</time>
</a>

    

  </div>
  <div class="article-inner">
    

    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      macでOSを自作（1日目）
    </h1>
  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <div class="article-sharing">
  <ul>
    <li>
      <a href="http://b.hatena.ne.jp/entry/http://haystacker.net/create-os-day1/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
    </li>
    <li>
      <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://haystacker.net/create-os-day1/" data-via="{{ theme.twitter }}" data-counturl="http://haystacker.net/create-os-day1/" >Tweet</a>
    </li>
    <li>
      <div class="fb-like" data-send="false" data-layout="button_count" data-show-faces="false" data-font="verdana" data-href="http://haystacker.net/create-os-day1/"></div>
    </li>
  </ul>
</div>

      
      
        
        <h1 id="バイナリによる-OS-イメージの作成"><a href="#バイナリによる-OS-イメージの作成" class="headerlink" title="バイナリによる OS イメージの作成"></a>バイナリによる OS イメージの作成</h1><p>0xED ファイルを開き、以下のように入力後、helloos.img として保存する。<br>（”55 AA F0 FF FF” 以降は 167FF2 までひたすら 0）<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">EB <span class="number">4</span>E <span class="number">90</span> <span class="number">48</span> <span class="number">45</span> <span class="number">4</span>C <span class="number">4</span>C <span class="number">4</span>F <span class="number">49</span> <span class="number">50</span> <span class="number">4</span>C <span class="number">00</span> <span class="number">02</span> <span class="number">01</span> <span class="number">01</span> <span class="number">00</span> <span class="number">02</span> E0 <span class="number">00</span> <span class="number">40</span> <span class="number">0</span>B F0 <span class="number">09</span> <span class="number">00</span> <span class="number">12</span> <span class="number">00</span> <span class="number">02</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">40</span> <span class="number">0</span>B <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">29</span> FF FF FF FF <span class="number">48</span> <span class="number">45</span> <span class="number">4</span>C <span class="number">4</span>C <span class="number">4</span>F <span class="number">2</span>D <span class="number">4</span>F <span class="number">53</span> <span class="number">20</span> <span class="number">20</span> <span class="number">20</span> <span class="number">46</span> <span class="number">41</span> <span class="number">54</span> <span class="number">31</span> <span class="number">32</span> <span class="number">20</span> <span class="number">20</span> <span class="number">20</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> B8 <span class="number">00</span> <span class="number">00</span> <span class="number">8</span>E D0 BC <span class="number">00</span> <span class="number">7</span>C <span class="number">8</span>E D8 <span class="number">8</span>E C0 BE</span><br><span class="line"><span class="number">74</span> <span class="number">7</span>C <span class="number">8</span>A <span class="number">04</span> <span class="number">83</span> C6 <span class="number">01</span> <span class="number">3</span>C <span class="number">00</span> <span class="number">74</span> <span class="number">09</span> B4 <span class="number">0</span>E BB <span class="number">0</span>F <span class="number">00</span> CD <span class="number">10</span> EB EE F4 EB FD <span class="number">0</span>A <span class="number">0</span>A <span class="number">68</span> <span class="number">65</span> <span class="number">6</span>C <span class="number">6</span>C <span class="number">6</span>F <span class="number">2</span>C</span><br><span class="line"><span class="number">20</span> <span class="number">77</span> <span class="number">6</span>F <span class="number">72</span> <span class="number">6</span>C <span class="number">64</span> <span class="number">0</span>A <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">55</span> AA F0 FF FF <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">(省略)</span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/create-os-day1//0xed.png"><br>..ほど気も長くないので、projects/01_day/helloos0/helloos.img をコピーして使い回しました f–;</p>
<p>今後のために Makefile を作成し、動作確認だけしておく。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">run :</span><br><span class="line">  qemu-system-i386 -m 32 -rtc base=localtime -drive format=raw,file=helloos.img,if=floppy</span><br></pre></td></tr></table></figure></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make <span class="keyword">run</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<h1 id="アセンブラによる-OS-イメージの作成（その1）"><a href="#アセンブラによる-OS-イメージの作成（その1）" class="headerlink" title="アセンブラによる OS イメージの作成（その1）"></a>アセンブラによる OS イメージの作成（その1）</h1><p>nasm 形式で OS イメージを作成する。<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">DB	<span class="number">0xeb</span>, <span class="number">0x4e</span>, <span class="number">0x90</span>, <span class="number">0x48</span>, <span class="number">0x45</span>, <span class="number">0x4c</span>, <span class="number">0x4c</span>, <span class="number">0x4f</span></span><br><span class="line">DB	<span class="number">0x49</span>, <span class="number">0x50</span>, <span class="number">0x4c</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span></span><br><span class="line">DB	<span class="number">0x02</span>, <span class="number">0xe0</span>, <span class="number">0x00</span>, <span class="number">0x40</span>, <span class="number">0x0b</span>, <span class="number">0xf0</span>, <span class="number">0x09</span>, <span class="number">0x00</span></span><br><span class="line">DB	<span class="number">0x12</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span></span><br><span class="line">DB	<span class="number">0x40</span>, <span class="number">0x0b</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x29</span>, <span class="number">0xff</span></span><br><span class="line">DB	<span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x48</span>, <span class="number">0x45</span>, <span class="number">0x4c</span>, <span class="number">0x4c</span>, <span class="number">0x4f</span></span><br><span class="line">DB	<span class="number">0x2d</span>, <span class="number">0x4f</span>, <span class="number">0x53</span>, <span class="number">0x20</span>, <span class="number">0x20</span>, <span class="number">0x20</span>, <span class="number">0x46</span>, <span class="number">0x41</span></span><br><span class="line">DB	<span class="number">0x54</span>, <span class="number">0x31</span>, <span class="number">0x32</span>, <span class="number">0x20</span>, <span class="number">0x20</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x00</span></span><br><span class="line">TIMES <span class="number">16</span>	DB	<span class="number">0</span></span><br><span class="line">DB	<span class="number">0xb8</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x8e</span>, <span class="number">0xd0</span>, <span class="number">0xbc</span>, <span class="number">0x00</span>, <span class="number">0x7c</span></span><br><span class="line">DB	<span class="number">0x8e</span>, <span class="number">0xd8</span>, <span class="number">0x8e</span>, <span class="number">0xc0</span>, <span class="number">0xbe</span>, <span class="number">0x74</span>, <span class="number">0x7c</span>, <span class="number">0x8a</span></span><br><span class="line">DB	<span class="number">0x04</span>, <span class="number">0x83</span>, <span class="number">0xc6</span>, <span class="number">0x01</span>, <span class="number">0x3c</span>, <span class="number">0x00</span>, <span class="number">0x74</span>, <span class="number">0x09</span></span><br><span class="line">DB	<span class="number">0xb4</span>, <span class="number">0x0e</span>, <span class="number">0xbb</span>, <span class="number">0x0f</span>, <span class="number">0x00</span>, <span class="number">0xcd</span>, <span class="number">0x10</span>, <span class="number">0xeb</span></span><br><span class="line">DB	<span class="number">0xee</span>, <span class="number">0xf4</span>, <span class="number">0xeb</span>, <span class="number">0xfd</span>, <span class="number">0x0a</span>, <span class="number">0x0a</span>, <span class="number">0x68</span>, <span class="number">0x65</span></span><br><span class="line">DB	<span class="number">0x6c</span>, <span class="number">0x6c</span>, <span class="number">0x6f</span>, <span class="number">0x2c</span>, <span class="number">0x20</span>, <span class="number">0x77</span>, <span class="number">0x6f</span>, <span class="number">0x72</span></span><br><span class="line">DB	<span class="number">0x6c</span>, <span class="number">0x64</span>, <span class="number">0x0a</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span></span><br><span class="line">TIMES	<span class="number">368</span>	DB	<span class="number">0</span></span><br><span class="line">DB	<span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x55</span>, <span class="number">0xaa</span></span><br><span class="line">DB	<span class="number">0xf0</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span></span><br><span class="line">TIMES	<span class="number">4600</span>	DB	<span class="number">0</span></span><br><span class="line">DB	<span class="number">0xf0</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span></span><br><span class="line">TIMES	<span class="number">1469432</span> DB	<span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<p>DB 命令で、バイナリエディタで記述したものと同じ値を書き込んでおり、、<br>“TIMES (繰り返し回数) DB 0” で指定した回数分 0 を書き込んでいる。</p>
<p>書籍のソースコードをベースに nasm 用に書き換えている箇所の差分は以下の通り。<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(省略)</span><br><span class="line">-	RESB	<span class="number">16</span></span><br><span class="line">+	TIMES <span class="number">16</span>	DB	<span class="number">0</span></span><br><span class="line">(省略)</span><br><span class="line">-	RESB	<span class="number">368</span></span><br><span class="line">+	TIMES	<span class="number">368</span>	DB	<span class="number">0</span></span><br><span class="line">(省略)</span><br><span class="line">-	RESB	<span class="number">4600</span></span><br><span class="line">+	TIMES	<span class="number">4600</span>	DB	<span class="number">0</span></span><br><span class="line">(省略)</span><br><span class="line">-	RESB	<span class="number">1469432</span></span><br><span class="line">+	TIMES	<span class="number">1469432</span> DB	<span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<p>ついでに Makefile をビルドできるように以下の通り修正しておく。<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">IN_FILE = helloos.asm</span><br><span class="line">OUT_FILE = helloos.img</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">	make build</span><br><span class="line">	make run</span><br><span class="line"></span><br><span class="line">build:</span><br><span class="line">	nasm <span class="variable">$&#123;IN_FILE&#125;</span> -o <span class="variable">$&#123;OUT_FILE&#125;</span></span><br><span class="line"></span><br><span class="line">run:</span><br><span class="line">  qemu-system-i386 -m 32 -rtc <span class="attribute">base</span>=localtime -drive <span class="attribute">format</span>=raw,file=$&#123;OUT_FILE&#125;,<span class="attribute">if</span>=floppy</span><br><span class="line">clean:</span><br><span class="line">	rm -f <span class="variable">$&#123;OUT_FILE&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>以下のコマンドで HariboteOS が起動を確認する。<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">$</span> make <span class="keyword">all</span></span><br></pre></td></tr></table></figure></p>
<h1 id="アセンブラによる-OS-イメージの作成（その2）"><a href="#アセンブラによる-OS-イメージの作成（その2）" class="headerlink" title="アセンブラによる OS イメージの作成（その2）"></a>アセンブラによる OS イメージの作成（その2）</h1><p>./projects/01_day/helloos2/helloos.asm をベースに nasm 様に以下の通り書き換える。<br>“0x1fe-$” のままだと nasm 書式の場合怒られるので、”0x1fe-($-$$)” として変更している。<br>“$” は行頭の位置、”$$” はセクション開始位置を表しているので、”($-$$)” でセクション開始位置からの相対的な位置を意味している。<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(省略)</span><br><span class="line">-	RESB	<span class="number">18</span>		; とりあえず<span class="number">18</span>バイトあけておく</span><br><span class="line">+	TIMES	<span class="number">18</span>  DB  <span class="number">0</span>		; とりあえず<span class="number">18</span>バイトあけておく</span><br><span class="line">(省略)</span><br><span class="line">-	RESB	<span class="number">0x1fe</span>-$		; <span class="number">0x001fe</span>までを<span class="number">0x00</span>で埋める命令</span><br><span class="line">+	TIMES	<span class="number">0x1fe</span>-($-$$)  DB  <span class="number">0</span>		; <span class="number">0x001fe</span>までを<span class="number">0x00</span>で埋める命令</span><br><span class="line">(省略)</span><br><span class="line">-	RESB	<span class="number">4600</span></span><br><span class="line">+	TIMES	<span class="number">4600</span>  DB  <span class="number">0</span></span><br><span class="line">(省略)</span><br><span class="line">-	RESB	<span class="number">1469432</span></span><br><span class="line">+	TIMES	<span class="number">1469432</span> DB  <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<p>全文は以下の通りとなる。<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">; hello-os</span><br><span class="line">; TAB=<span class="number">4</span></span><br><span class="line"></span><br><span class="line">; 以下は標準的なFAT12フォーマットフロッピーディスクのための記述</span><br><span class="line"></span><br><span class="line">	DB	<span class="number">0xeb</span>, <span class="number">0x4e</span>, <span class="number">0x90</span></span><br><span class="line">	DB	<span class="string">"HELLOIPL"</span>	; ブートセクタの名前を自由に書いてよい（<span class="number">8</span>バイト）</span><br><span class="line">	DW	<span class="number">512</span>		; <span class="number">1</span>セクタの大きさ（<span class="number">512</span>にしなければいけない）</span><br><span class="line">	DB	<span class="number">1</span>		; クラスタの大きさ（<span class="number">1</span>セクタにしなければいけない）</span><br><span class="line">	DW	<span class="number">1</span>		; FATがどこから始まるか（普通は<span class="number">1</span>セクタ目からにする）</span><br><span class="line">	DB	<span class="number">2</span>		; FATの個数（<span class="number">2</span>にしなければいけない）</span><br><span class="line">	DW	<span class="number">224</span>		; ルートディレクトリ領域の大きさ（普通は<span class="number">224</span>エントリにする）</span><br><span class="line">	DW	<span class="number">2880</span>		; このドライブの大きさ（<span class="number">2880</span>セクタにしなければいけない）</span><br><span class="line">	DB	<span class="number">0xf0</span>		; メディアのタイプ（<span class="number">0xf0</span>にしなければいけない）</span><br><span class="line">	DW	<span class="number">9</span>		; FAT領域の長さ（<span class="number">9</span>セクタにしなければいけない）</span><br><span class="line">	DW	<span class="number">18</span>		; <span class="number">1</span>トラックにいくつのセクタがあるか（<span class="number">18</span>にしなければいけない）</span><br><span class="line">	DW	<span class="number">2</span>		; ヘッドの数（<span class="number">2</span>にしなければいけない）</span><br><span class="line">	DD	<span class="number">0</span>		; パーティションを使ってないのでここは必ず<span class="number">0</span></span><br><span class="line">	DD	<span class="number">2880</span>		; このドライブ大きさをもう一度書く</span><br><span class="line">	DB	<span class="number">0</span>,<span class="number">0</span>,<span class="number">0x29</span>	; よくわからないけどこの値にしておくといいらしい</span><br><span class="line">	DD	<span class="number">0xffffffff</span>	; たぶんボリュームシリアル番号</span><br><span class="line">	DB	<span class="string">"HELLO-OS   "</span>	; ディスクの名前（<span class="number">11</span>バイト）</span><br><span class="line">	DB	<span class="string">"FAT12   "</span>	; フォーマットの名前（<span class="number">8</span>バイト）</span><br><span class="line">	TIMES	<span class="number">18</span>  DB  <span class="number">0</span>		; とりあえず<span class="number">18</span>バイトあけておく</span><br><span class="line"></span><br><span class="line">; プログラム本体</span><br><span class="line"></span><br><span class="line">	DB	<span class="number">0xb8</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x8e</span>, <span class="number">0xd0</span>, <span class="number">0xbc</span>, <span class="number">0x00</span>, <span class="number">0x7c</span></span><br><span class="line">	DB	<span class="number">0x8e</span>, <span class="number">0xd8</span>, <span class="number">0x8e</span>, <span class="number">0xc0</span>, <span class="number">0xbe</span>, <span class="number">0x74</span>, <span class="number">0x7c</span>, <span class="number">0x8a</span></span><br><span class="line">	DB	<span class="number">0x04</span>, <span class="number">0x83</span>, <span class="number">0xc6</span>, <span class="number">0x01</span>, <span class="number">0x3c</span>, <span class="number">0x00</span>, <span class="number">0x74</span>, <span class="number">0x09</span></span><br><span class="line">	DB	<span class="number">0xb4</span>, <span class="number">0x0e</span>, <span class="number">0xbb</span>, <span class="number">0x0f</span>, <span class="number">0x00</span>, <span class="number">0xcd</span>, <span class="number">0x10</span>, <span class="number">0xeb</span></span><br><span class="line">	DB	<span class="number">0xee</span>, <span class="number">0xf4</span>, <span class="number">0xeb</span>, <span class="number">0xfd</span></span><br><span class="line"></span><br><span class="line">; メッセージ部分</span><br><span class="line"></span><br><span class="line">	DB	<span class="number">0x0a</span>, <span class="number">0x0a</span>	; 改行を<span class="number">2</span>つ</span><br><span class="line">	DB	<span class="string">"hello, world"</span></span><br><span class="line">	DB	<span class="number">0x0a</span>		; 改行</span><br><span class="line">	DB	<span class="number">0</span></span><br><span class="line"></span><br><span class="line">	TIMES	<span class="number">0x1fe</span>-($-$$)  DB  <span class="number">0</span>		; <span class="number">0x001fe</span>までを<span class="number">0x00</span>で埋める命令</span><br><span class="line"></span><br><span class="line">	DB	<span class="number">0x55</span>, <span class="number">0xaa</span></span><br><span class="line"></span><br><span class="line">; 以下はブートセクタ以外の部分の記述</span><br><span class="line"></span><br><span class="line">	DB	<span class="number">0xf0</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span></span><br><span class="line">	TIMES	<span class="number">4600</span>  DB  <span class="number">0</span></span><br><span class="line">	DB	<span class="number">0xf0</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span></span><br><span class="line">	TIMES	<span class="number">1469432</span> DB  <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<p>細かいルールや根拠的なものはまだわからないが、「アセンブラによる OS イメージの作成（その１）」のコードを比較すると、一部のコードが日本語や10進数で書かれることでかなり見やすいものになっている。</p>

      
      
        

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://haystacker.net/create-os-day1/" data-id="cjmi1ncz400034zij7zfn6ot9" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OS/">OS</a></li></ul>


    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/create-os-day2/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer Post</strong>
      <div class="article-nav-title">
        
          macでOSを自作（2日目）
        
      </div>
    </a>
  
  
    <a href="/create-os-day0/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older Post</strong>
      <div class="article-nav-title">macでOSを自作（0日目）</div>
    </a>
  
</nav>


  
</article>



</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 id="widget-title-about" class="widget-title">About</h3>
    <div class="widget">
      
        <p> Hayato Otsuka </p>
      
      
        <p> <a href="http://twitter.com/jundo414">@jundo414</a> </p>
      
      </p>
      
        <p> 東京界隈に出没する仮想化基盤/クラウド系のITエンジニア </p>
      
      
        <p>  </p>
      
    </div>
  </div>


  
    

  
    
  <div class="widget-wrap">
    <h3 id="widget-title-tag" class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/OS/">OS</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenStack/">OpenStack</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 id="widget-title-tagcloud" class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/OS/" style="font-size: 20px;">OS</a> <a href="/tags/OpenStack/" style="font-size: 10px;">OpenStack</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 id="widget-title-archive" class="widget-title" data-skip-mobile-nav="true">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">7</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 id="widget-title-recent-posts" class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/create-os-day3-1/">macでOSを自作（3日目）-1</a>
          </li>
        
          <li>
            <a href="/create-os-day3/">macでOSを自作（3日目）</a>
          </li>
        
          <li>
            <a href="/create-os-day2/">macでOSを自作（2日目）</a>
          </li>
        
          <li>
            <a href="/create-os-day1/">macでOSを自作（1日目）</a>
          </li>
        
          <li>
            <a href="/create-os-day0/">macでOSを自作（0日目）</a>
          </li>
        
      </ul>
    </div>
  </div>


  
</aside>

        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      Copyrights &copy; 2018 Hayato Otsuka All Rights Reserved. <br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.
      Themed by <a href="https://github.com/kwhrtsk/hexo-theme-ingenuous">Ingenuous</a> (based on <a href="https://github.com/hexojs/hexo-theme-landscape">Landscape</a>).
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>

    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/ja_JP/sdk.js#xfbml=1&version=v2.4";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<script src="/js/script.js"></script>


  </div>
</body>
</html>
